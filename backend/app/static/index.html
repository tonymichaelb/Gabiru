<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chroma</title>
  <link rel="stylesheet" href="/static/styles.css?v=10" />
</head>
<body>
  <main class="wrap">
    <header class="bar">
      <h1>Chroma</h1>
      <div class="status" id="connStatus">desconectado</div>
    </header>

    <div class="toast-host" id="toastHost" aria-live="polite" aria-relevant="additions" aria-atomic="false"></div>

    <div class="update-banner" id="updateBanner" style="display:none;">
      <div class="update-banner-text" id="updateBannerText">Nova atualização disponível.</div>
      <button type="button" class="secondary" id="updateReloadBtn">Recarregar</button>
    </div>

    <nav class="tabs" aria-label="Abas">
      <button type="button" class="tab active" data-tab="print" id="tabPrint">Impressão</button>
      <button type="button" class="tab" data-tab="motion" id="tabMotion">Movimento</button>
      <button type="button" class="tab" data-tab="system" id="tabSystem">Sistema</button>
    </nav>

    <section class="tab-panel" data-tab="print" id="panelPrint">

    <section class="card">
      <h2>Arquivos (.gcode)</h2>
      <div class="row row-upload">
        <input id="uploadInput" type="file" accept=".gcode" />
        <button id="uploadBtn">Upload</button>
        <button id="refreshFilesBtn" class="secondary">Atualizar lista</button>
        <button id="deleteFileBtn" class="danger">Excluir selecionado</button>
      </div>
      <div class="file-browser" aria-label="Arquivos G-code">
        <div class="file-list" id="fileList"></div>
        <div class="file-preview" id="filePreview">
          <div class="muted">Selecione um arquivo para ver a prévia.</div>
        </div>
      </div>

      <div class="row row-job-controls">
        <div class="selected-file">
          <div class="label">Arquivo selecionado</div>
          <div class="value" id="selectedFile">—</div>
        </div>
        <button id="startBtn">Iniciar</button>
        <button id="pauseBtn" class="secondary">Pausar</button>
        <button id="resumeBtn" class="secondary">Retomar</button>
        <button id="cancelBtn" class="danger">Cancelar</button>
      </div>
      <div class="row row-job-status">
        <div class="kv"><span>Job:</span> <span id="jobFile">—</span></div>
        <div class="kv"><span>Estado:</span> <span id="jobState">—</span></div>
        <div class="kv"><span>Progresso:</span> <span id="jobProgress">0%</span></div>
        <div class="kv"><span>Hotend:</span> <span id="hotend">—</span></div>
        <div class="kv"><span>Bed:</span> <span id="bed">—</span></div>
      </div>
    </section>

    <section class="card">
      <h2>Time-lapse</h2>
      <div class="row row-timelapse">
        <button id="tlStartBtn">Iniciar</button>
        <button id="tlStopBtn" class="secondary">Parar e gerar vídeo</button>
        <button id="tlRefreshBtn" class="secondary">Atualizar lista</button>
        <a id="tlLastLink" class="btn-link" href="#" target="_blank" rel="noreferrer">Baixar último</a>
      </div>
      <div class="timelapse-live">
        <div class="label">Ao vivo</div>
        <img id="tlLiveImg" class="timelapse-live-img" alt="Prévia ao vivo" />
        <div id="tlLiveHint" class="muted">Inicie o time-lapse para ver a prévia ao vivo.</div>
      </div>
      <div class="timelapse-meta" id="tlMeta"></div>
      <div class="timelapse-list" id="tlList"></div>
    </section>

    </section>

    <section class="tab-panel hidden" data-tab="motion" id="panelMotion">

    <section class="card">
      <h2>Movimento</h2>

      <div class="row row-jog-settings">
        <label>
          Passo (mm)
          <select id="jogStep">
            <option value="0.1">0.1</option>
            <option value="1" selected>1</option>
            <option value="10">10</option>
          </select>
        </label>
        <button id="homeBtn">Home (G28)</button>
        <button id="g29Btn" class="secondary">G29 (Auto level)</button>
      </div>

      <div class="jog-grid" aria-label="Movimento X e Y">
        <div></div>
        <button id="jogYPos" class="secondary">Y+</button>
        <div></div>
        <button id="jogXNeg" class="secondary">X-</button>
        <div class="muted jog-center">XY</div>
        <button id="jogXPos" class="secondary">X+</button>
        <div></div>
        <button id="jogYNeg" class="secondary">Y-</button>
        <div></div>
      </div>

      <div class="jog-z" aria-label="Movimento Z">
        <button id="jogZUp" class="secondary">Z+</button>
        <button id="jogZDown" class="secondary">Z-</button>
      </div>
    </section>

    <section class="card">
      <h2>PID</h2>

      <div class="row row-pid" aria-label="PID Hotend">
        <label>
          Hotend alvo (°C)
          <input id="pidHotendTemp" type="number" min="0" max="320" step="1" value="200" />
        </label>
        <label>
          Ciclos
          <input id="pidHotendCycles" type="number" min="1" max="20" step="1" value="5" />
        </label>
        <button id="pidHotendBtn">PID Hotend</button>
      </div>

      <div class="row row-pid" aria-label="PID Mesa">
        <label>
          Mesa alvo (°C)
          <input id="pidBedTemp" type="number" min="0" max="150" step="1" value="60" />
        </label>
        <label>
          Ciclos
          <input id="pidBedCycles" type="number" min="1" max="20" step="1" value="5" />
        </label>
        <button id="pidBedBtn" class="secondary">PID Mesa</button>
      </div>

      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Executa M303 (Marlin). Os resultados aparecem no Terminal.
      </div>
    </section>

    </section>

    <section class="tab-panel hidden" data-tab="system" id="panelSystem">

    <section class="card">
      <h2>Conexão</h2>
      <div class="row">
        <div class="muted" id="fixedPortLabel" style="display:none; align-self: center;">Porta: /dev/ttyACM0</div>
        <button id="connectBtn">Conectar</button>
        <button id="disconnectBtn" class="secondary">Desconectar</button>
      </div>
    </section>

    <section class="card">
      <h2>Wi‑Fi</h2>
      <div class="muted" id="wifiStatusLabel" style="margin-top: 4px;">Status: —</div>
      <div class="row" style="margin-top: 10px;">
        <button id="wifiScanBtn" class="secondary">Buscar redes</button>
        <select id="wifiSsidSelect" style="min-width: 240px;"></select>
      </div>
      <div class="row" style="margin-top: 10px;">
        <input id="wifiPassword" type="password" placeholder="Senha (se houver)" />
        <button id="wifiConnectBtn">Conectar</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Se estiver em modo hotspot, ao conectar no Wi‑Fi o hotspot pode desligar.
      </div>
    </section>

    <section class="card">
      <h2>Atualização</h2>
      <div class="row">
        <button id="updateNowBtn" class="secondary">Atualizar agora</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        No Raspberry: executa o auto-update (git pull + reinicia o serviço).
      </div>
    </section>

    <section class="card">
      <h2>Temperatura (manual)</h2>
      <div class="row row-temp">
        <label>
          Hotend (°C)
          <input id="hotendSet" type="number" min="0" max="320" step="1" placeholder="Ex.: 200" />
        </label>
        <label>
          Bed (°C)
          <input id="bedSet" type="number" min="0" max="150" step="1" placeholder="Ex.: 60" />
        </label>
        <button id="setTempBtn">Aplicar</button>
        <button id="hotendOffBtn" class="secondary">Hotend OFF</button>
        <button id="bedOffBtn" class="secondary">Bed OFF</button>
        <button id="allOffBtn" class="danger">Tudo OFF</button>
      </div>
      <div class="row row-temp-hint">
        <div class="muted">Dica: usa M104/M140 (não espera aquecer). O status atual aparece em “Hotend/Bed”.</div>
      </div>
    </section>

    <section class="card">
      <h2>Terminal</h2>
      <div class="row">
        <input id="cmdInput" placeholder="Ex.: M105" />
        <button id="sendBtn">Enviar</button>
        <button id="pollBtn" class="secondary">Status</button>
      </div>
      <pre class="terminal" id="terminal"></pre>
    </section>

    </section>
  </main>

  <footer class="footer" aria-label="Rodapé">
    <div class="footer-left">
      <span class="footer-app">Gabiru</span>
      <span class="footer-sep">•</span>
      <span class="footer-version" id="footerVersion">versão —</span>
    </div>
  </footer>

  <script src="/static/app.js?v=17"></script>
</body>
</html>
