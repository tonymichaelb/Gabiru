<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chroma</title>
  <link rel="stylesheet" href="/static/styles.css?v=10" />
</head>
<body>
  <main class="wrap">
    <header class="bar">
      <h1>Chroma</h1>
      <div class="status" id="connStatus">desconectado</div>
      <div class="status" id="filamentStatus" style="margin-left: 10px;" title="Status do sensor de filamento">‚Äî</div>
    </header>

    <div class="toast-host" id="toastHost" aria-live="polite" aria-relevant="additions" aria-atomic="false"></div>

    <div class="update-banner" id="updateBanner" style="display:none;">
      <div class="update-banner-text" id="updateBannerText">Nova atualiza√ß√£o dispon√≠vel.</div>
      <button type="button" class="secondary" id="updateReloadBtn">Recarregar</button>
    </div>

    <nav class="tabs" aria-label="Abas">
      <button type="button" class="tab active" data-tab="print" id="tabPrint">Impress√£o</button>
      <button type="button" class="tab" data-tab="motion" id="tabMotion">Movimento</button>
      <button type="button" class="tab" data-tab="colorir" id="tabColorir">Colorir</button>
      <button type="button" class="tab" data-tab="system" id="tabSystem">Sistema</button>
    </nav>

    <section class="tab-panel" data-tab="print" id="panelPrint">

    <section class="card">
      <h2>Arquivos (.gcode)</h2>
      <div class="row row-upload">
        <input id="uploadInput" type="file" accept=".gcode" />
        <button id="uploadBtn">Upload</button>
        <button id="refreshFilesBtn" class="secondary">Atualizar lista</button>
        <button id="deleteFileBtn" class="danger">Excluir selecionado</button>
      </div>
      <div class="file-browser" aria-label="Arquivos G-code">
        <div class="file-list" id="fileList"></div>
        <div class="file-preview" id="filePreview">
          <div class="muted">Selecione um arquivo para ver a pr√©via.</div>
        </div>
      </div>

      <div class="row row-job-controls">
        <div class="selected-file">
          <div class="label">Arquivo selecionado</div>
          <div class="value" id="selectedFile">‚Äî</div>
        </div>
        <button id="startBtn">Iniciar</button>
        <button id="pauseBtn" class="secondary">Pausar</button>
        <button id="resumeBtn" class="secondary">Retomar</button>
        <button id="cancelBtn" class="danger">Cancelar</button>
      </div>
      <div class="row row-job-status">
        <div class="kv"><span>Job:</span> <span id="jobFile">‚Äî</span></div>
        <div class="kv"><span>Estado:</span> <span id="jobState">‚Äî</span></div>
        <div class="kv"><span>Progresso:</span> <span id="jobProgress">0%</span></div>
        <div class="kv"><span>Hotend:</span> <span id="hotend">‚Äî</span></div>
        <div class="kv"><span>Bed:</span> <span id="bed">‚Äî</span></div>
      </div>
    </section>

    <section class="card">
      <h2>Time-lapse</h2>
      <div class="row row-timelapse">
        <button id="tlStartBtn">Iniciar</button>
        <button id="tlStopBtn" class="secondary">Parar e gerar v√≠deo</button>
        <button id="tlRefreshBtn" class="secondary">Atualizar lista</button>
        <a id="tlLastLink" class="btn-link" href="#" target="_blank" rel="noreferrer">Baixar √∫ltimo</a>
      </div>
      <div class="timelapse-live">
        <div class="label">Ao vivo</div>
        <img id="tlLiveImg" class="timelapse-live-img" alt="Pr√©via ao vivo" />
        <div id="tlLiveHint" class="muted">Inicie o time-lapse para ver a pr√©via ao vivo.</div>
      </div>
      <div class="timelapse-meta" id="tlMeta"></div>
      <div class="timelapse-list" id="tlList"></div>
    </section>

    </section>

    <section class="tab-panel hidden" data-tab="motion" id="panelMotion">

    <section class="card">
      <h2>Movimento</h2>

      <div class="row row-jog-settings">
        <label>
          Passo (mm)
          <select id="jogStep">
            <option value="0.1">0.1</option>
            <option value="1" selected>1</option>
            <option value="10">10</option>
          </select>
        </label>
        <button id="homeBtn">Home (G28)</button>
        <button id="g29Btn" class="secondary">G29 (Auto level)</button>
      </div>

      <div class="jog-grid" aria-label="Movimento X e Y">
        <div></div>
        <button id="jogYPos" class="secondary">Y+</button>
        <div></div>
        <button id="jogXNeg" class="secondary">X-</button>
        <div class="muted jog-center">XY</div>
        <button id="jogXPos" class="secondary">X+</button>
        <div></div>
        <button id="jogYNeg" class="secondary">Y-</button>
        <div></div>
      </div>

      <div class="jog-z" aria-label="Movimento Z">
        <button id="jogZUp" class="secondary">Z+</button>
        <button id="jogZDown" class="secondary">Z-</button>
      </div>
    </section>

    <section class="card">
      <h2>PID</h2>

      <div class="row row-pid" aria-label="PID Hotend">
        <label>
          Hotend alvo (¬∞C)
          <input id="pidHotendTemp" type="number" min="0" max="320" step="1" value="200" />
        </label>
        <label>
          Ciclos
          <input id="pidHotendCycles" type="number" min="1" max="20" step="1" value="5" />
        </label>
        <button id="pidHotendBtn">PID Hotend</button>
      </div>

      <div class="row row-pid" aria-label="PID Mesa">
        <label>
          Mesa alvo (¬∞C)
          <input id="pidBedTemp" type="number" min="0" max="150" step="1" value="60" />
        </label>
        <label>
          Ciclos
          <input id="pidBedCycles" type="number" min="1" max="20" step="1" value="5" />
        </label>
        <button id="pidBedBtn" class="secondary">PID Mesa</button>
      </div>

      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Executa M303 (Marlin). Os resultados aparecem no Terminal.
      </div>
    </section>

    <section class="card">
      <h2>Temperatura</h2>
      <div class="row row-temp">
        <label>
          Hotend (¬∞C)
          <input id="hotendSet" type="number" min="0" max="320" step="1" placeholder="Ex.: 200" />
        </label>
        <label>
          Bed (¬∞C)
          <input id="bedSet" type="number" min="0" max="150" step="1" placeholder="Ex.: 60" />
        </label>
        <button id="setTempBtn">Aplicar</button>
        <button id="hotendOffBtn" class="secondary">Hotend OFF</button>
        <button id="bedOffBtn" class="secondary">Bed OFF</button>
        <button id="allOffBtn" class="danger">Tudo OFF</button>
      </div>
      <div class="row row-temp-hint">
        <div class="muted">Usa M104/M140 (n√£o espera aquecer). Status atual em "Hotend/Bed".</div>
      </div>
    </section>

    <section class="card">
      <h2>Extrus√£o / Retra√ß√£o</h2>
      <div class="row row-extrude">
        <label>
          Entrada de filamento (T)
          <select id="extruderTool">
            <option value="0" selected>T0</option>
            <option value="1">T1</option>
            <option value="2">T2</option>
            <option value="3">T3</option>
            <option value="4">T4</option>
            <option value="5">T5</option>
            <option value="6">T6</option>
            <option value="7">T7</option>
            <option value="8">T8</option>
            <option value="9">T9</option>
            <option value="10">T10</option>
            <option value="11">T11</option>
            <option value="12">T12</option>
            <option value="13">T13</option>
            <option value="14">T14</option>
            <option value="15">T15</option>
            <option value="16">T16</option>
            <option value="17">T17</option>
            <option value="18">T18</option>
          </select>
        </label>
        <label>
          Dist√¢ncia (mm)
          <input id="extrudeAmount" type="number" min="1" max="100" step="1" value="10" />
        </label>
        <label>
          Velocidade (mm/s)
          <input id="extrudeSpeed" type="number" min="1" max="50" step="1" value="5" />
        </label>
        <button id="extrudeBtn">Extruir</button>
        <button id="retractBtn" class="secondary">Retrair</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Para 1 bico com v√°rias entradas: seleciona T0‚ÄìT18 e depois extrude/retire. Certifique-se de que o hotend est√° aquecido.
      </div>
    </section>

    </section>

    <section class="tab-panel hidden" data-tab="colorir" id="panelColorir">

    <section class="card">
      <h2>Colorir</h2>

      <div class="row" id="pincelButtons" aria-label="Pinc√©is (T0‚ÄìT18)">
        <button type="button" class="secondary" data-pincel-tool="0">Pincel 0</button>
        <button type="button" class="secondary" data-pincel-tool="1">Pincel 1</button>
        <button type="button" class="secondary" data-pincel-tool="2">Pincel 2</button>
        <button type="button" class="secondary" data-pincel-tool="3">Pincel 3</button>
        <button type="button" class="secondary" data-pincel-tool="4">Pincel 4</button>
        <button type="button" class="secondary" data-pincel-tool="5">Pincel 5</button>
        <button type="button" class="secondary" data-pincel-tool="6">Pincel 6</button>
        <button type="button" class="secondary" data-pincel-tool="7">Pincel 7</button>
        <button type="button" class="secondary" data-pincel-tool="8">Pincel 8</button>
        <button type="button" class="secondary" data-pincel-tool="9">Pincel 9</button>
        <button type="button" class="secondary" data-pincel-tool="10">Pincel 10</button>
        <button type="button" class="secondary" data-pincel-tool="11">Pincel 11</button>
        <button type="button" class="secondary" data-pincel-tool="12">Pincel 12</button>
        <button type="button" class="secondary" data-pincel-tool="13">Pincel 13</button>
        <button type="button" class="secondary" data-pincel-tool="14">Pincel 14</button>
        <button type="button" class="secondary" data-pincel-tool="15">Pincel 15</button>
        <button type="button" class="secondary" data-pincel-tool="16">Pincel 16</button>
        <button type="button" class="secondary" data-pincel-tool="17">Pincel 17</button>
        <button type="button" class="secondary" data-pincel-tool="18">Pincel 18</button>
      </div>

      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Selecione um pincel para trabalhar. Requer conex√£o no WebSocket. <span id="activePincelStatus" style="font-weight: 600; color: #3b82f6;"></span>
      </div>

      <div class="card" style="margin-top: 12px; background: #0f172a0d;">
        <h3 style="margin-top: 0;">Ajuda</h3>
        <div class="muted" style="font-size: 12px; line-height: 1.4;">
          1) Clique em um Pincel (0‚Äì18) para selecionar onde vai aplicar a cor.<br />
          2) Clique em uma Tinta (1‚Äì19) para escolher a cor/mistura daquela tinta.<br />
          3) Para trocar a cor de uma tinta, use o painel de Mistura abaixo.<br />
          4) O total A/B/C precisa somar 100% (aplica via M182).
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Tintas</h2>
      <div class="row" id="tintaButtons" aria-label="Tintas (M182)">
        <button type="button" class="secondary round-btn" data-gcode="M182 A0 B0 C100" data-a="0" data-b="0" data-c="100">1</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A100 B0 C0" data-a="100" data-b="0" data-c="0">2</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A0 B100 C0" data-a="0" data-b="100" data-c="0">3</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A80 B0 C20" data-a="80" data-b="0" data-c="20">4</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A90 B0 C10" data-a="90" data-b="0" data-c="10">5</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A40 B0 C60" data-a="40" data-b="0" data-c="60">6</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A15 B0 C85" data-a="15" data-b="0" data-c="85">7</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A20 B10 C70" data-a="20" data-b="10" data-c="70">8</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A0 B40 C60" data-a="0" data-b="40" data-c="60">9</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A0 B25 C75" data-a="0" data-b="25" data-c="75">10</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A10 B80 C10" data-a="10" data-b="80" data-c="10">11</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A50 B50 C0" data-a="50" data-b="50" data-c="0">12</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A70 B20 C10" data-a="70" data-b="20" data-c="10">13</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A33 B33 C34" data-a="33" data-b="33" data-c="34">14</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A85 B0 C15" data-a="85" data-b="0" data-c="15">15</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A20 B0 C80" data-a="20" data-b="0" data-c="80">16</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A70 B10 C20" data-a="70" data-b="10" data-c="20">17</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A33 B33 C34" data-a="33" data-b="33" data-c="34">18</button>
        <button type="button" class="secondary round-btn" data-gcode="M182 A20 B10 C70" data-a="20" data-b="10" data-c="70">19</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Clique para selecionar e aplicar uma tinta. <span id="activeTintaStatus" style="font-weight: 600; color: #3b82f6;"></span>
      </div>

      <div class="row" style="margin-top: 16px; gap: 8px;">
        <button type="button" class="secondary" id="limparTintaBtn" title="Limpar tinta atual (M182 A0 B0 C0)">üßπ Limpar Tinta</button>
        <button type="button" class="secondary" id="resetarPincelBtn" title="Voltar ao pincel padr√£o (T0)">üîÑ Resetar Pincel</button>
        <button type="button" class="secondary" id="purgarBtn" title="Purgar filamento (G1 E50 F300)">üíß Purgar (50mm)</button>
      </div>
      <div id="colorirConnectionStatus" class="muted" style="margin-top: 8px; font-size: 12px; text-align: center;">
        ‚ö†Ô∏è Aguardando conex√£o...
      </div>
    </section>

    <section class="card">
      <h2>Mistura</h2>
      <div class="muted" style="font-size: 12px;">Selecione uma tinta (1‚Äì19) para ajustar A (azul), B (vermelho), C (amarelo) em %.</div>
      <div class="row" style="align-items: flex-end; gap: 10px; margin-top: 10px;">
        <div class="muted" id="mixSelectedLabel" style="min-width: 90px;">Tinta: ‚Äî</div>
        <label>
          A (azul) %
          <input id="mixInputA" type="number" min="0" max="100" step="1" value="33" />
        </label>
        <label>
          B (vermelho) %
          <input id="mixInputB" type="number" min="0" max="100" step="1" value="33" />
        </label>
        <label>
          C (amarelo) %
          <input id="mixInputC" type="number" min="0" max="100" step="1" value="34" />
        </label>
        <button type="button" id="mixApplyBtn" class="secondary">Aplicar na tinta</button>
      </div>
      <div class="muted" id="mixTotalLabel" style="margin-top: 6px; font-size: 12px;">Total: ‚Äî</div>
      <div class="muted" style="margin-top: 6px; font-size: 12px;">
        Isso atualiza a tinta selecionada (o que ela aplica quando voc√™ clicar nela).
      </div>
    </section>

    </section>

    <section class="tab-panel hidden" data-tab="system" id="panelSystem">

    <section class="card">
      <h2>Conex√£o</h2>
      <div class="row">
        <div class="muted" id="fixedPortLabel" style="display:none; align-self: center;">Porta: /dev/ttyACM0</div>
        <button id="connectBtn">Conectar</button>
        <button id="disconnectBtn" class="secondary">Desconectar</button>
      </div>
    </section>

    <section class="card">
      <h2>Wi‚ÄëFi</h2>
      <div class="muted" id="wifiStatusLabel" style="margin-top: 4px;">Status: ‚Äî</div>
      <div class="row" style="margin-top: 10px;">
        <button id="wifiScanBtn" class="secondary">Buscar redes</button>
        <select id="wifiSsidSelect" style="min-width: 240px;"></select>
      </div>
      <div class="row" style="margin-top: 10px;">
        <input id="wifiPassword" type="password" placeholder="Senha (se houver)" />
        <button id="wifiConnectBtn">Conectar</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        Se estiver em modo hotspot, ao conectar no Wi‚ÄëFi o hotspot pode desligar.
      </div>
    </section>

    <section class="card">
      <h2>Atualiza√ß√£o</h2>
      <div class="row">
        <button id="updateNowBtn" class="secondary">Atualizar agora</button>
      </div>
      <div class="muted" style="margin-top: 8px; font-size: 12px;">
        No Raspberry: executa o auto-update (git pull + reinicia o servi√ßo).
      </div>
    </section>

    <section class="card">
      <h2>Terminal</h2>
      <div class="row">
        <input id="cmdInput" placeholder="Ex.: M105" />
        <button id="sendBtn">Enviar</button>
        <button id="pollBtn" class="secondary">Status</button>
      </div>
      <pre class="terminal" id="terminal"></pre>
    </section>

    <section class="card">
      <h2>Conta</h2>
      <div class="row" style="align-items: center;">
        <div class="muted" id="accountUserLabel">Usu√°rio: ‚Äî</div>
        <button id="logoutBtn" class="secondary">Sair</button>
      </div>

      <div class="row" style="margin-top: 10px;">
        <div class="muted" id="accountHint" style="font-size: 12px;">Voc√™ precisa estar logado para gerenciar conta e usu√°rios.</div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <label style="min-width: 260px;">
          Senha atual
          <input id="pwCurrent" type="password" />
        </label>
        <label style="min-width: 260px;">
          Nova senha
          <input id="pwNew" type="password" />
        </label>
        <label style="min-width: 260px;">
          Confirmar nova senha
          <input id="pwNewConfirm" type="password" />
        </label>
        <button id="changePwBtn">Trocar senha</button>
      </div>

      <div class="row" style="margin-top: 14px;">
        <label style="min-width: 220px;">
          Novo usu√°rio
          <input id="newUserName" placeholder="Ex.: maria" />
        </label>
        <label style="min-width: 240px;">
          Senha
          <input id="newUserPw" type="password" />
        </label>
        <label style="min-width: 260px;">
          Confirmar senha
          <input id="newUserPwConfirm" type="password" />
        </label>
        <button id="createUserBtn" class="secondary">Criar usu√°rio</button>
      </div>

      <div class="row" style="margin-top: 14px;">
        <button id="resetUsersBtn" class="danger">Resetar usu√°rios (apagar todos)</button>
        <div class="muted" style="font-size: 12px;">A√ß√£o perigosa. S√≥ funciona se GABIRU_ALLOW_USER_RESET=1 estiver habilitado.</div>
      </div>
    </section>

    </section>
  </main>

  <footer class="footer" aria-label="Rodap√©">
    <div class="footer-left">
      <span class="footer-app">Gabiru</span>
      <span class="footer-sep">‚Ä¢</span>
      <span class="footer-version" id="footerVersion">vers√£o ‚Äî</span>
    </div>
  </footer>

  <script src="/static/app.js?v=17"></script>
</body>
</html>
